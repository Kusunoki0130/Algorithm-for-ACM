## 简介

基本的线段树可以视作一种建立在数组上的分治手段，解决的问题大多是线性的（也存在树形结构上的线段树方法，另说）。一般问题会涉及到序列上的多种类型完全不同、给定下标范围的操作（比如要求序列可以修改和查询），线段树可以将每种操作都做到 $O(log_2n)$ 的时间实现。

本部分涉及以下内容：入门线段树（区间求和等基本问题）、权值线段树的应用、区间合并线段树、线段树动态开点、扫描线。

进阶内容如线段树合并、线段树分裂以及一些大牛的线段树优化会在之后更新。

可持久化线段树收录在可持久化数据结构中。

下面是两篇初学线段树时写的博客：

[线段树（简单实现高效区间操作）](https://blog.csdn.net/weixin_43843835/article/details/88750190)

[线段树求解各种问题的模板（单点修改、区间修改、扫描线思想）](https://blog.csdn.net/weixin_43843835/article/details/89607141)



## 线段树基础模板1

**原题链接：**[P3372 【模板】线段树 1](https://www.luogu.com.cn/problem/P3372)

已知一个长度为 $n$ 的数列 $a$ 和 $m$ 个操作，操作有两种：

1. 给定 $x,y,k$ ，将下标范围 $[x,y]$ 内的每个数都加 $k$ ；
2. 给定 $x,y$ ， 输出下标范围 $[x,y]$ 中数值的总和 。

约定 $1\leq n,m \leq 10^5$，操作 2 保证结果在 int64 内。

**思路：** 带懒标记的基本线段树。



## 线段树基础模板2

**原题链接：**[P3373 【模板】线段树 2](https://www.luogu.com.cn/problem/P3373)

已知模数 $p$ ， 一个长度为 $n$ 的数列 $a$ 和 $m$ 个操作，操作有三种：

1. 给定 $x,y,k$ ，将下标范围 $[x,y]$ 内的每个数都**加** $k$ ；
2. 给定 $x,y,k$ ，将下标范围 $[x,y]$ 内的每个数都**乘** $k$ ；
3. 给定 $x,y$ ， 输出下标范围 $[x,y]$ 中数值的总和对 $p$ 取模的结果。

约定 $1\leq n,m \leq 10^5$。

**思路：** 带懒标记的基本线段树，维护两个懒标记，分别表示加和乘，同时需要注意两种标记往下推的顺序。



## 权值线段树求逆序对个数

**原题链接：**[P1908 逆序对](https://www.luogu.com.cn/problem/P1908)

已知一个长度为 $n$ 的序列 $a$ ，求序列中逆序对的个数。

（逆序对：满足 $a_i>a_j$ 且 $i<j$ 的有序对）

约定 $n \leq 5\times10^5 $ ，序列中的任意数不超过 $10^9$。

**思路：** 对于下标 $i$ , 只需要知道下标小于 $i$ 且比 $a_i$ 大的元素个数，然后对每个下标求出的结果累计即可得到逆序对的个数。首先对原序列排个序，知道每个数字的排名，原序列中的数字用排名取代，构成新序列 $b$ ，同时记最大排名为 $b_{max}$ 。然后，用线段树维护每个排名出现的次数，每次查询区间 $[b_i+1, b_{max}]$ 中数字的个数，累计到答案中。最后，更新一次线段树，将排名 $b_i$ 出现的次数加 $1$。



## 权值线段树求三元组个数

**原题链接：**[P1637 三元上升子序列](https://www.luogu.com.cn/problem/P1637)

已知一个长度为 $n$ 的序列 $a$ ，求序列中三元上升子序列的个数。

（三元上升子序列：满足$i<j<k$ 且 $a_i < a_j < a_k$ 的有序对）

约定 $n \leq 5\times10^5 $ ，序列中的任意数不超过 $10^9$。

**思路：** 与计算逆序对的手法基本相同， 对于下标 $i$ , 查询一次下标比它小同时数值比它小的元素个数 $x_1$，再查询一次下标比它大同时数值比它大的元素个数 $x_2$，答案累计 $x_1x_2$。



## 待更新



